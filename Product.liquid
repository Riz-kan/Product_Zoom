<!-- ====== HEAD (fonts + theme globals) ====== -->
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&family=Playfair+Display:wght@400;500&display=swap" rel="stylesheet">

<!-- Theme globals required by product-form.js -->
<script>
  window.Theme = window.Theme || {};
  Theme.routes = Theme.routes || { cart_add_url: "{{ routes.cart_add_url }}" };
  Theme.translations = Theme.translations || { added: "Added to cart" };
</script>

<!-- Your theme components -->
<script src="{{ 'product-form.js' | asset_url }}" type="module"></script>
<script src="{{ 'fly-to-cart-init.js' | asset_url }}" type="module"></script>

<section class="pdp-scope">
  <div class="product-wrapper">
    <!-- LEFT: Product Image + Thumbnails + Mobile Scroller -->
    <div class="product-image">
      <div class="product-thumbnails" id="pdp-productThumbnails"></div>
      <img id="pdp-mainProductImage" src="" alt="Product"/>
      <!-- MOBILE: Horizontal image scroller -->
      <div class="mobile-image-strip" id="pdp-mobileImageStrip" aria-label="Product Images" tabindex="0"></div>
    </div>

    <!-- RIGHT: Product Info & Form -->
    <div class="product-form">
      <p class="product-label">NEW ARRIVAL</p>
      <h1 class="product-title">CloudNine Hanging Rest Spot</h1>
      <p class="product-price">$19.99</p>

      <!-- Selling points (with top/bottom dividers) -->
      <div class="sp-block" aria-label="Product highlights">
        <ul class="sp-list">
          <li>
            <span class="sp-icon dot" aria-hidden="true"></span>
            <span>Ready to ship</span>
          </li>

          <li>
            <span class="sp-icon" aria-hidden="true">
              <!-- Truck -->
              <svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M5.83268 15.8333C6.27471 15.8333 6.69863 15.6577 7.01119 15.3452C7.32375 15.0326 7.49935 14.6087 7.49935 14.1667C7.49935 13.7246 7.32375 13.3007 7.01119 12.9882C6.69863 12.6756 6.27471 12.5 5.83268 12.5C5.39065 12.5 4.96673 12.6756 4.65417 12.9882C4.34161 13.3007 4.16602 13.7246 4.16602 14.1667C4.16602 14.6087 4.34161 15.0326 4.65417 15.3452C4.96673 15.6577 5.39065 15.8333 5.83268 15.8333ZM14.166 15.8333C14.608 15.8333 15.032 15.6577 15.3445 15.3452C15.6571 15.0326 15.8327 14.6087 15.8327 14.1667C15.8327 13.7246 15.6571 13.3007 15.3445 12.9882C15.032 12.6756 14.608 12.5 14.166 12.5C13.724 12.5 13.3001 12.6756 12.9875 12.9882C12.6749 13.3007 12.4993 13.7246 12.4993 14.1667C12.4993 14.6087 12.6749 15.0326 12.9875 15.3452C13.3001 15.6577 13.724 15.8333 14.166 15.8333Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                <path d="M11.666 14.1667V5.5C11.666 5.36739 11.6133 5.24021 11.5196 5.14645C11.4258 5.05268 11.2986 5 11.166 5H2.16602C2.03341 5 1.90623 5.05268 1.81246 5.14645C1.71869 5.24021 1.66602 5.36739 1.66602 5.5V13.6667C1.66602 13.7323 1.67895 13.7973 1.70408 13.858C1.7292 13.9187 1.76603 13.9738 1.81246 14.0202C1.85889 14.0666 1.91401 14.1035 1.97467 14.1286C2.03534 14.1537 2.10035 14.1667 2.16602 14.1667H3.87435M11.666 14.1667H7.54102M11.666 14.1667H12.4993M11.666 7.5H16.341C16.4377 7.50002 16.5322 7.52806 16.6133 7.58071C16.6943 7.63336 16.7584 7.70837 16.7977 7.79667L18.2893 11.1533C18.3178 11.2171 18.3325 11.286 18.3327 11.3558V13.6667C18.3327 13.7323 18.3197 13.7973 18.2946 13.858C18.2695 13.9187 18.2327 13.9738 18.1862 14.0202C18.1398 14.0666 18.0847 14.1035 18.024 14.1286C17.9634 14.1537 17.8983 14.1667 17.8327 14.1667H16.2493" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path>
              </svg>
            </span>
            <span>Worldwide shipping available</span>
          </li>

          <li>
            <span class="sp-icon" aria-hidden="true">
              <!-- Tag -->
              <svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M7.864 18.4498L1.50004 12.0859C1.40627 11.9921 1.35359 11.8649 1.35359 11.7323C1.35359 11.5997 1.40627 11.4725 1.50004 11.3787L9.20691 3.67187C9.32476 3.55402 9.49447 3.50217 9.65887 3.53458L14.9622 4.59524C15.059 4.61457 15.148 4.66216 15.2178 4.73201C15.2877 4.80185 15.3353 4.89082 15.3546 4.98768L16.4153 10.291C16.4314 10.3718 16.4273 10.4553 16.4034 10.5342C16.3794 10.613 16.3363 10.6848 16.278 10.7429L8.5711 18.4498C8.52468 18.4962 8.46956 18.5331 8.40889 18.5582C8.34823 18.5833 8.28321 18.5963 8.21755 18.5963C8.15189 18.5963 8.08687 18.5833 8.02621 18.5582C7.96555 18.5331 7.91043 18.4962 7.864 18.4498Z" stroke="currentColor" stroke-width="1.5"></path>
                <circle cx="12.084" cy="7.91663" r="1.125" fill="none" stroke="currentColor" stroke-width="1.5"></circle>
              </svg>
            </span>
            <span>Buy 5 and get 2 free!</span>
          </li>
        </ul>
      </div>

      <div class="product-rating">★★★★★ <span>(4.7)</span></div>
      <p class="product-shade" style="display:none;">Shade: <span id="selectedShade"></span></p>

      <!-- COLOR SWATCHES -->
      <div class="swatch-wrapper" id="pdp-swatchWrapper"></div>

      <p class="product-description">
        The ultimate chill zone for comfort-loving cats—CloudNine™ gives them a front-row seat to the outside world while soaking up the sun. Watch them stretch, lounge, and snooze as elevated views ease anxiety and satisfy their inner observer. Minimal, secure, and irresistibly cozy—your cat’s new favorite spot starts here.
      </p>

      <product-form-component data-product-id="7770300416118" data-url="{{ routes.cart_add_url }}">
        <form id="pdp-form" method="post">
          <input type="hidden" name="id" value="" ref="variantId" id="pdp-variantIdInput"/>

          <!-- Quantity (inside the form) -->
          <div class="quantity-wrapper">
            <button type="button" class="qty-btn" id="pdp-qtyMinus">−</button>
            <span class="qty-display" id="pdp-qtyValue">1</span>
            <button type="button" class="qty-btn" id="pdp-qtyPlus">+</button>
            <input type="hidden" name="quantity" value="1" id="pdp-quantityInput"/>
          </div>

          <add-to-cart-component
            ref="addToCartButtonContainer"
            id="pdp-addToCartComponent"
            data-product-variant-media=""
            data-add-to-cart-animation="true">
            <button
              type="submit"
              ref="addToCartButton"
              class="atc-button"
              onclick="
                this.closest('add-to-cart-component').handleClick(event);
                this.closest('product-form-component').handleSubmit(event);
              "
              aria-label="Add this item to your cart">
              <span class="bg-slide"></span>
              <span class="label">ADD TO CART</span>
            </button>
          </add-to-cart-component>

          <!-- Error container used by product-form.js -->
          <p ref="addToCartTextError" class="add-to-cart-error hidden" aria-live="polite"></p>

          <!-- Optional accelerated checkout block (toggles hidden/unhidden by product-form.js) -->
          <div ref="acceleratedCheckoutButtonContainer" hidden></div>

          <button type="button" class="buy-now-button">BUY IT NOW</button>
          <div ref="liveRegion" class="visually-hidden" aria-live="polite"></div>
        </form>
      </product-form-component>

      <!-- Accordion -->
      <div class="product-details-accordion">
        <section class="accordion-section" aria-label="Product details">
          <div class="accordion">
            <button class="accordion-header" type="button" aria-expanded="false" aria-controls="acc-panel-1" id="acc-trigger-1">
              <span>Shipping</span>
              <span class="accordion-icon">+</span>
            </button>
            <div class="accordion-body" id="acc-panel-1" role="region" aria-labelledby="acc-trigger-1">
              <div class="accordion-content">
                <p>For orders placed before 7am AEDT, we endeavour to process the same business day. Orders placed after 11am AEDT will be processed the next business day.</p>
                <p>During sale events and new collection launches, there may be a slightly longer processing time.</p>
                <p>All orders are hand-picked and packed with care.</p>
              </div>
            </div>
          </div>

          <div class="accordion">
            <button class="accordion-header" type="button" aria-expanded="false" aria-controls="acc-panel-2" id="acc-trigger-2">
              <span>Returns</span>
              <span class="accordion-icon">+</span>
            </button>
            <div class="accordion-body" id="acc-panel-2" role="region" aria-labelledby="acc-trigger-2">
              <div class="accordion-content">
                <p>You can choose between a refund or a credit note on full-priced items.</p>
                <ul>
                  <li>Item(s) must be returned in original condition and packaging.</li>
                  <li>Earrings cannot be returned for health reasons.</li>
                  <li>Return shipping is the customer’s responsibility.</li>
                  <li>Sale items are not refundable for change of mind.</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="accordion">
            <button class="accordion-header" type="button" aria-expanded="false" aria-controls="acc-panel-3" id="acc-trigger-3">
              <span>Fabric &amp; Care</span>
              <span class="accordion-icon">+</span>
            </button>
            <div class="accordion-body" id="acc-panel-3" role="region" aria-labelledby="acc-trigger-3">
              <div class="accordion-content">
                <p>Composition: 98% Cotton, 2% Elastane. Soft hand-feel with light stretch.</p>
                <ul>
                  <li>Machine wash cold, gentle cycle</li>
                  <li>Wash with like colors</li>
                  <li>Do not bleach</li>
                  <li>Line dry; cool iron on reverse if needed</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="accordion">
            <button class="accordion-header" type="button" aria-expanded="false" aria-controls="acc-panel-4" id="acc-trigger-4">
              <span>Size &amp; Fit</span>
              <span class="accordion-icon">+</span>
            </button>
            <div class="accordion-body" id="acc-panel-4" role="region" aria-labelledby="acc-trigger-4">
              <div class="accordion-content">
                <p>Fits true to size. Peplum hem hits at the high hip; square neckline.</p>
                <ul>
                  <li>Model is 174cm / 5'8" and wears size S</li>
                  <li>Body length (S): 54cm; Chest (S): 86cm</li>
                  <li>Refer to the size guide for exact measurements</li>
                </ul>
              </div>
            </div>
          </div>
        </section>
      </div>
      <!-- /Accordion -->
    </div>
  </div>

  <div class="pdp-zoom" data-zoom-root>
    <div class="pdp-zoom__lightbox" data-zoom-lightbox role="dialog" aria-modal="true" aria-hidden="true">
      <div class="pdp-zoom__counter" data-zoom-counter aria-live="polite"></div>
      <div class="pdp-zoom__controls">
        <button type="button" class="pdp-zoom__btn" data-zoom-toggle aria-label="Zoom in">+</button>
        <button type="button" class="pdp-zoom__btn" data-zoom-close aria-label="Close">×</button>
    </div>
    <div class="pdp-zoom__side-nav" data-zoom-nav>
      <button type="button" class="pdp-zoom__btn" data-zoom-prev aria-label="Previous image">❮</button>
      <button type="button" class="pdp-zoom__btn" data-zoom-next aria-label="Next image">❯</button>
    </div>
    <div class="pdp-zoom__dots" data-zoom-dots></div>
    <div class="pdp-zoom__stage" data-zoom-stage>
      <img class="pdp-zoom__image" data-zoom-image alt="">
    </div>
  </div>

</section>

<style>
  .hidden { display: none !important; }
  .visually-hidden {
    position: absolute !important; width: 1px; height: 1px; padding: 0; margin: -1px;
    overflow: hidden; clip: rect(0 0 0 0); white-space: nowrap; border: 0;
  }

  

  .pdp-scope body { font-family: 'Inter', sans-serif; }
  .pdp-scope .product-wrapper {
    display: flex; gap: 2rem; max-width: 1400px; margin: 0 auto; padding: 2rem 3rem;
    align-items: flex-start;
  }
  .pdp-scope .product-image { flex: 0 0 50%; display: flex; gap: 1rem; position: relative; align-items: flex-start; }
  .pdp-scope .product-thumbnails { display: flex; flex-direction: column; gap: 0.4rem; width: 20%; max-width: 60px; }
  .pdp-scope .thumbnail { aspect-ratio: 3/4; width: 100%; object-fit: cover; border: none; cursor: pointer; transition: outline 0.2s; }
  .pdp-scope .thumbnail.active { outline: 1px solid #000; outline-offset: 2px; }
  .pdp-scope #pdp-mainProductImage { aspect-ratio: 4/5; width: 90%; object-fit: cover; display: block; cursor: zoom-in; }
  .pdp-scope .mobile-image-strip { display: none; }
  .pdp-scope .product-form { flex: 0 0 50%; }

  .pdp-scope .product-label { font-size: 0.7rem; color: #999; letter-spacing: 1.2px; margin-bottom: 0.4rem; text-transform: uppercase; }
  .pdp-scope .product-title { font-family: "Playfair Display", serif; font-size: 2rem; font-weight: 500; margin-bottom: 0.4rem; letter-spacing: 0.5px; }
  .pdp-scope .product-price { font-size: 1.3rem;margin-top: 0;  font-weight: 400; margin-bottom: 0.95rem; }
  .pdp-scope .product-rating { font-size: 0.95rem; margin-bottom: 0.7rem; }
  .pdp-scope .product-rating span { color: #aaa; margin-left: 0.25em; }
  /* Selling points block with top/bottom dividers */
  .pdp-scope .sp-block{
    border-top:1px solid #e3e3e3;
    border-bottom:1px solid #e3e3e3;
    padding:10px 0;
    margin:12px 0; /* space from price & rating */
  }

  /* List + icons (scoped) */
  .pdp-scope .sp-list{list-style:none;margin:0;padding:0}
  .pdp-scope .sp-list li{
    display:grid;
    grid-template-columns:1.2em 1fr;
    align-items:center;
    column-gap:12px;
    color:#555;
    font-size:.95rem;
    line-height:1.4;
    margin:2px 0;
  }
  .pdp-scope .sp-icon{width:.95em;height:.95em;display:inline-grid;place-items:center;color:inherit}
  .pdp-scope .sp-icon svg{width:.95em;height:.95em;display:block}

  /* Green dot with subtle pulse */
  .pdp-scope .sp-icon.dot{
    position:relative;width:.8em;height:.8em;border-radius:50%;
    background:#79C48B;
  }
  .pdp-scope .sp-icon.dot::after{
    content:"";position:absolute;inset:0;border-radius:50%;
    background:#79C48B;opacity:.35;animation:pulse .9s ease-out infinite
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce){
    .pdp-scope .sp-icon.dot::after{animation:none;opacity:.25}
  }

  @keyframes pulse{
    0%{transform:scale(1);opacity:.35}
    70%{transform:scale(2.2);opacity:0}
    100%{transform:scale(1);opacity:0}
  }
  .pdp-scope .product-shade { font-size: 0.85rem; margin-bottom: 0.5rem; }
  .pdp-scope .product-description {
    font-size: 0.9rem;
    line-height: 1.4;
    margin-bottom: 1.2rem;
    font-weight: 300;
    color: #555;
  }

  .pdp-scope .atc-button { background: #fff; color: #111; border: 1px solid #111; padding: 0.75rem 1.5rem; font-size: 1rem; width: 100%; margin-bottom: 0.5rem; transition: all 0.3s ease; }
  .pdp-scope .atc-button:hover { background: #111; color: #fff; }
  .pdp-scope .buy-now-button { background: #111; color: #fff; border: none; padding: 0.75rem 1.5rem; font-size: 1rem; width: 100%; transition: background 0.3s ease; }
  .pdp-scope .buy-now-button:hover { background: #333; }
  .pdp-scope .add-to-cart-error { color: #c62828; font-size: .9rem; margin:.5rem 0 1rem; }

  .pdp-scope .swatch-wrapper { display: flex; align-items: center; gap: 0.4rem; margin-bottom: 1.1rem; }
  .pdp-scope .swatch { width: 26px; height: 26px; cursor: pointer; }
  .pdp-scope .swatch.selected { outline: 1px solid #111; outline-offset: 2px; }

  .pdp-scope .quantity-wrapper { display: flex; align-items: center; gap: 1rem; margin-bottom: 1.1rem; margin-top: 0.3rem; }
  .pdp-scope .qty-btn { width: 38px; height: 30px; border: 1px solid #ccc; background: #fff; cursor: pointer; font-size: 1.05rem; }
  .pdp-scope .qty-display { font-size: 0.98rem; }

  /* Accordion compact style */
  .pdp-scope .product-details-accordion { margin-top: 1.5rem; }
  .pdp-scope .accordion-section {
    margin-top: 1.5rem;
    padding-top: 0rem;
    border-top: 1px solid #e3e3e3;
    font-family: 'Inter', sans-serif;
  }
  .pdp-scope .accordion { border-bottom: 1px solid #e3e3e3; }
  .pdp-scope .accordion-header {
    width: 100%;
    display: flex; align-items: center; justify-content: space-between;
    padding: 0.6rem 0;        /* compact vertical padding */
    background: none; border: 0; cursor: pointer; text-align: left;
    font-size: 0.9rem;       /* smaller text */
    font-weight: 300;
    letter-spacing: 0.01em;
    color: inherit;
  }
  .pdp-scope .accordion-header:focus-visible { outline: 2px solid #000; outline-offset: 2px; }
  .pdp-scope .accordion-icon { font-size: 0.85rem; transition: transform 0.3s ease; }
  .pdp-scope .accordion-body { overflow: hidden; max-height: 0; transition: max-height 0.35s ease; will-change: max-height; }
  .pdp-scope .accordion-content { padding: 0 0 1rem; font-size: 0.9rem; line-height: 1.4; color: #555; }
  .pdp-scope .accordion-content ul { margin: 0.5rem 0 0 1.25rem; }

  .pdp-scope .pdp-zoom {
    --pdp-zoom-btn-size: 38px;
    --pdp-zoom-btn-bg: #111;
    --pdp-zoom-btn-bg-hover: #222;
    --pdp-zoom-btn-fg: #fff;
    --pdp-zoom-edge-gap: 18px;
    --pdp-zoom-dot: 10px;
    --pdp-zoom-ui-fade: 160ms;
  }

  .pdp-scope .pdp-zoom__lightbox {
    position: fixed;
    inset: 0;
    background: #fff;
    display: none;
    z-index: 40;
  }

  .pdp-scope .pdp-zoom__lightbox.open { display: block; }

  .pdp-scope .pdp-zoom__stage {
    position: absolute;
    inset: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    touch-action: none;
  }

  .pdp-scope .pdp-zoom__image {
    display: block;
    width: auto;
    height: auto;
    max-width: 90vw;
    max-height: 90vh;
    cursor: grab;
    user-select: none;
    -webkit-user-drag: none;
    will-change: transform;
    transition: transform .12s ease;
    transform-origin: 50% 50%;
  }

  .pdp-scope .pdp-zoom__lightbox.dragging .pdp-zoom__image {
    cursor: grabbing;
    transition: none;
  }

  .pdp-scope .pdp-zoom__controls,
  .pdp-scope .pdp-zoom__side-nav,
  .pdp-scope .pdp-zoom__dots,
  .pdp-scope .pdp-zoom__counter {
    position: absolute;
    z-index: 3;
  }

  .pdp-scope .pdp-zoom__btn {
    width: var(--pdp-zoom-btn-size);
    height: var(--pdp-zoom-btn-size);
    background: var(--pdp-zoom-btn-bg);
    color: var(--pdp-zoom-btn-fg);
    border: none;
    border-radius: 4px;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    font-size: 18px;
    line-height: 1;
    cursor: pointer;
    transition: background .2s ease, transform .1s ease, opacity var(--pdp-zoom-ui-fade) ease;
    box-shadow: 0 1px 3px rgba(0,0,0,.25);
  }

  .pdp-scope .pdp-zoom__btn:hover { background: var(--pdp-zoom-btn-bg-hover); }

  .pdp-scope .pdp-zoom__btn:active { transform: scale(.96); }

  .pdp-scope .pdp-zoom__controls {
    top: var(--pdp-zoom-edge-gap);
    right: var(--pdp-zoom-edge-gap);
    display: flex;
    gap: 10px;
  }

  .pdp-scope .pdp-zoom__side-nav {
    top: 50%;
    left: 0;
    right: 0;
    transform: translateY(-50%);
    pointer-events: none;
    display: flex;
    justify-content: space-between;
    padding: 0 var(--pdp-zoom-edge-gap);
  }

  .pdp-scope .pdp-zoom__side-nav .pdp-zoom__btn { pointer-events: auto; }

  .pdp-scope .pdp-zoom__counter {
    top: var(--pdp-zoom-edge-gap);
    left: var(--pdp-zoom-edge-gap);
    font-size: 13px;
    color: #111;
    opacity: .7;
  }

  .pdp-scope .pdp-zoom__dots {
    bottom: 16px;
    left: 0;
    right: 0;
    display: flex;
    justify-content: center;
    gap: 10px;
  }

  .pdp-scope .pdp-zoom__dot {
    width: var(--pdp-zoom-dot);
    height: var(--pdp-zoom-dot);
    border-radius: 50%;
    border: 1.5px solid #111;
    background: transparent;
    padding: 0;
    cursor: pointer;
  }

  .pdp-scope .pdp-zoom__dot[aria-current="true"] { background: #111; }

  .pdp-scope .pdp-zoom__lightbox.ui-hidden .pdp-zoom__btn,
  .pdp-scope .pdp-zoom__lightbox.ui-hidden .pdp-zoom__side-nav .pdp-zoom__btn { opacity: 0; }

  @media (prefers-reduced-motion: reduce) {
    .pdp-scope .pdp-zoom__btn,
    .pdp-scope .pdp-zoom__image { transition: none !important; }
  }
</style>

<script type="module">
  const pdpRoot = document.querySelector('.pdp-scope');

  if (pdpRoot) {
    const zoom = createZoomLightbox(pdpRoot);
    const mainImageEl = pdpRoot.querySelector('#pdp-mainProductImage');
    const thumbsDiv = pdpRoot.querySelector('#pdp-productThumbnails');
    const addToCartComponent = pdpRoot.querySelector('#pdp-addToCartComponent');
    const mobileImageStrip = pdpRoot.querySelector('#pdp-mobileImageStrip');
    const variantIdInput = pdpRoot.querySelector('#pdp-variantIdInput');
    const swatchWrapper = pdpRoot.querySelector('#pdp-swatchWrapper');

    if (mainImageEl) {
      mainImageEl.setAttribute('tabindex', '0');
      mainImageEl.setAttribute('role', 'button');
      mainImageEl.setAttribute('aria-label', 'Open image gallery');
    }

    const VARIANTS = [
      {
        id: "42445118799990",
        color: "#ADD8E6",
        title: "Blue",
        images: [
          "https://cdn.shopify.com/s/files/1/0623/9718/6166/files/Sbfd9b49d5eb548c9bb90a8dfa8b675c9Z.webp?v=1754469861",
          "https://cdn.shopify.com/s/files/1/0623/9718/6166/files/image_-_2025-08-06T103216.764.jpg?v=1754456548"
        ]
      },
      {
        id: "42445118767222",
        color: "#F5F5DC",
        title: "Beige",
        images: [
          "https://cdn.shopify.com/s/files/1/0623/9718/6166/files/S35b203ac434149a1ba4677e31bd7e4e2J.webp?v=1754470146",
          "https://cdn.shopify.com/s/files/1/0623/9718/6166/files/image_-_2025-08-06T103216.764.jpg?v=1754456548"
        ]
      },
      {
        id: "42445118734454",
        color: "#000000",
        title: "Black",
        images: [
          "https://cdn.shopify.com/s/files/1/0623/9718/6166/files/S8824b71e1a6f47638b1e18eb39e7cb9bo.webp?v=1754469647",
          "https://cdn.shopify.com/s/files/1/0623/9718/6166/files/image_-_2025-08-06T103216.764.jpg?v=1754456548"
        ]
      },
      {
        id: "42445118832758",
        color: "#FFC0CB",
        title: "Pink",
        images: [
          "https://cdn.shopify.com/s/files/1/0623/9718/6166/files/S2c775e89f8fa41a4b5643fabe786d4e5x.webp?v=1754469766",
          "https://cdn.shopify.com/s/files/1/0623/9718/6166/files/image_-_2025-08-06T103216.764.jpg?v=1754456548"
        ]
      }
    ];

    let currentVariant = null;
    let currentImages = [];
    let activeIndex = 0;
    let mobileLastIndex = 0;

    function mapVariantImages(variant) {
      return (variant?.images || []).map((src, idx) => ({
        src,
        alt: `${variant.title || 'Product'} image ${idx + 1}`
      }));
    }

    function applyMainImage(index) {
      if (!mainImageEl) return;
      const image = currentImages[index];
      if (!image) return;
      mainImageEl.src = image.src;
      mainImageEl.alt = image.alt || `Product image ${index + 1}`;
      mainImageEl.setAttribute('aria-label', `Open image ${index + 1} of ${currentImages.length}`);
      if (addToCartComponent) {
        addToCartComponent.dataset.productVariantMedia = image.src;
      }
    }

    function setActiveThumbnail(index) {
      if (!thumbsDiv) return;
      thumbsDiv.querySelectorAll('.thumbnail').forEach((thumb, idx) => {
        thumb.classList.toggle('active', idx === index);
        thumb.setAttribute('aria-current', idx === index ? 'true' : 'false');
      });
    }

    function selectImage(index, openerEl = null, { open = false } = {}) {
      if (!currentImages.length) return;
      const normalized = (index + currentImages.length) % currentImages.length;
      activeIndex = normalized;
      mobileLastIndex = normalized;
      applyMainImage(normalized);
      setActiveThumbnail(normalized);
      if (open) {
        zoom.openAt(normalized, openerEl);
      }
    }

    function renderThumbnails(images) {
      if (!thumbsDiv) return;
      thumbsDiv.innerHTML = '';
      images.forEach((image, i) => {
        const thumb = document.createElement('img');
        thumb.className = 'thumbnail' + (i === activeIndex ? ' active' : '');
        thumb.src = image.src;
        thumb.alt = image.alt || `Thumbnail ${i + 1}`;
        thumb.loading = i === 0 ? 'eager' : 'lazy';
        thumb.decoding = 'async';
        thumb.tabIndex = 0;
        thumb.setAttribute('role', 'button');
        thumb.setAttribute('aria-current', i === activeIndex ? 'true' : 'false');
        thumb.addEventListener('click', () => selectImage(i, thumb, { open: true }));
        thumb.addEventListener('keydown', (event) => {
          if (event.key === 'Enter' || event.key === ' ') {
            event.preventDefault();
            selectImage(i, thumb, { open: true });
          }
        });
        thumbsDiv.appendChild(thumb);
      });
    }

    function renderMobileStrip(images) {
      if (!mobileImageStrip) return;
      mobileImageStrip.innerHTML = '';
      images.forEach((image, i) => {
        const img = document.createElement('img');
        img.src = image.src;
        img.loading = i === 0 ? 'eager' : 'lazy';
        img.decoding = 'async';
        img.dataset.index = String(i);
        img.alt = image.alt || `Product image ${i + 1}`;
        img.setAttribute('role', 'group');
        img.setAttribute('aria-label', `Image ${i + 1} of ${images.length}`);
        img.addEventListener('click', () => selectImage(i, img, { open: true }));
        mobileImageStrip.appendChild(img);
      });
    }

    function selectVariant(index) {
      const variant = VARIANTS[index];
      if (!variant) return;
      currentVariant = variant;
      currentImages = mapVariantImages(variant);
      activeIndex = 0;
      mobileLastIndex = 0;

      if (swatchWrapper) {
        swatchWrapper.querySelectorAll('.swatch').forEach((sw, i) => {
          sw.classList.toggle('selected', i === index);
        });
      }

      if (variantIdInput) {
        variantIdInput.value = variant.id;
      }

      renderThumbnails(currentImages);
      renderMobileStrip(currentImages);
      zoom.setImages(currentImages);

      if (currentImages.length) {
        selectImage(0);
      } else if (mainImageEl) {
        mainImageEl.removeAttribute('src');
        mainImageEl.removeAttribute('aria-label');
      }
    }

    if (swatchWrapper) {
      swatchWrapper.innerHTML = '';
      VARIANTS.forEach((variant, idx) => {
        const sw = document.createElement('div');
        sw.className = 'swatch' + (idx === 0 ? ' selected' : '');
        sw.style.backgroundColor = variant.color;
        sw.title = variant.title;
        sw.dataset.variantId = variant.id;
        sw.tabIndex = 0;
        sw.addEventListener('click', () => selectVariant(idx));
        sw.addEventListener('keydown', (event) => {
          if (event.key === 'Enter' || event.key === ' ') {
            event.preventDefault();
            selectVariant(idx);
          }
        });
        swatchWrapper.appendChild(sw);
      });
    }

    if (mainImageEl) {
      mainImageEl.addEventListener('click', () => {
        if (!currentImages.length) return;
        zoom.openAt(activeIndex, mainImageEl);
      });
      mainImageEl.addEventListener('keydown', (event) => {
        if (!currentImages.length) return;
        if (event.key === 'Enter' || event.key === ' ') {
          event.preventDefault();
          zoom.openAt(activeIndex, mainImageEl);
        }
      });
    }

    if (mobileImageStrip) {
      let scrollTimer = 0;
      mobileImageStrip.addEventListener('scroll', () => {
        clearTimeout(scrollTimer);
        scrollTimer = setTimeout(() => {
          const imagesEls = Array.from(mobileImageStrip.querySelectorAll('img'));
          if (!imagesEls.length) return;
          const scrollLeft = mobileImageStrip.scrollLeft;
          let minDist = Infinity;
          let newIndex = 0;
          imagesEls.forEach((img, idx) => {
            const dist = Math.abs(img.offsetLeft - scrollLeft);
            if (dist < minDist) {
              minDist = dist;
              newIndex = idx;
            }
          });
          if (newIndex !== mobileLastIndex) {
            selectImage(newIndex, imagesEls[newIndex], { open: false });
          }
        }, 100);
      });
    }

    selectVariant(0);

    let qty = 1;
    const qtyInput = pdpRoot.querySelector('#pdp-quantityInput');
    const qtyValue = pdpRoot.querySelector('#pdp-qtyValue');
    pdpRoot.querySelector('#pdp-qtyPlus').addEventListener('click', () => {
      qty = Math.min(10, qty + 1);
      qtyValue.textContent = qty;
      qtyInput.value = qty;
    });
    pdpRoot.querySelector('#pdp-qtyMinus').addEventListener('click', () => {
      qty = Math.max(1, qty - 1);
      qtyValue.textContent = qty;
      qtyInput.value = qty;
    });

    const accordionContainer = pdpRoot.querySelector('.product-details-accordion');
  if (accordionContainer) {
      const allowMultiple = true;
      const accordions = accordionContainer.querySelectorAll('.accordion');

      const openAcc = (acc) => {
        const header = acc.querySelector('.accordion-header');
        const panel = acc.querySelector('.accordion-body');
        const icon = acc.querySelector('.accordion-icon');
        if (!panel || !header) return;
        panel.style.maxHeight = panel.scrollHeight + 'px';
        header.setAttribute('aria-expanded', 'true');
        acc.classList.add('open');
        if (icon) icon.textContent = '−';
      };

      const closeAcc = (acc) => {
        const header = acc.querySelector('.accordion-header');
        const panel = acc.querySelector('.accordion-body');
        const icon = acc.querySelector('.accordion-icon');
        if (!panel || !header) return;
        panel.style.maxHeight = panel.scrollHeight + 'px';
        void panel.offsetHeight;
        panel.style.maxHeight = '0px';
        header.setAttribute('aria-expanded', 'false');
        acc.classList.remove('open');
        if (icon) icon.textContent = '+';
      };

      const toggleAcc = (targetAcc) => {
        const isOpen = targetAcc.classList.contains('open');
        if (!allowMultiple) {
          accordions.forEach((acc) => {
            if (acc !== targetAcc) closeAcc(acc);
          });
        }
        isOpen ? closeAcc(targetAcc) : openAcc(targetAcc);
      };

      accordions.forEach((acc) => {
        const header = acc.querySelector('.accordion-header');
        const panel = acc.querySelector('.accordion-body');
        const icon = acc.querySelector('.accordion-icon');
        if (!header || !panel) return;

        header.addEventListener('click', () => toggleAcc(acc));
        header.addEventListener('keydown', (event) => {
          if (event.key === 'Enter' || event.key === ' ') {
            event.preventDefault();
            toggleAcc(acc);
          }
        });

        header.setAttribute('aria-expanded', 'false');
        panel.style.maxHeight = '0px';
        acc.classList.remove('open');
        if (icon) icon.textContent = '+';
      });

      window.addEventListener('resize', () => {
        accordionContainer.querySelectorAll('.accordion.open .accordion-body').forEach((panel) => {
          panel.style.maxHeight = panel.scrollHeight + 'px';
        });
      });

      const firstAccordion = accordions[0];
      if (firstAccordion) openAcc(firstAccordion);
    }
  }

  function createZoomLightbox(rootEl) {
    const zoomRoot = rootEl?.querySelector('[data-zoom-root]');
    if (!zoomRoot) {
      return { setImages: () => {}, openAt: () => {} };
    }

    const lightbox = zoomRoot.querySelector('[data-zoom-lightbox]');
    const stage = zoomRoot.querySelector('[data-zoom-stage]');
    const zoomedImage = zoomRoot.querySelector('[data-zoom-image]');
    const zoomToggle = zoomRoot.querySelector('[data-zoom-toggle]');

    if (!lightbox || !stage || !zoomedImage || !zoomToggle) {
      return { setImages: () => {}, openAt: () => {} };
    }

    const body = document.body;
    const closeBtn = zoomRoot.querySelector('[data-zoom-close]');
    const prevBtn = zoomRoot.querySelector('[data-zoom-prev]');
    const nextBtn = zoomRoot.querySelector('[data-zoom-next]');
    const dotsWrap = zoomRoot.querySelector('[data-zoom-dots]');
    const counter = zoomRoot.querySelector('[data-zoom-counter]');
    const sideNav = zoomRoot.querySelector('[data-zoom-nav]');

    const state = { scale: 1, min: 1, max: 4, tx: 0, ty: 0, baseW: 0, baseH: 0, viewW: 0, viewH: 0 };
    const viewer = { index: 0, isOpen: false, openerEl: null };
    const clamp = (v, a, b) => Math.min(Math.max(v, a), b);
    const pts = new Map();
    let pinchStart = null;
    let raf = null;
    let idleTimer = null;
    let startDrag = null;
    let images = [];

    const apply = () => {
      zoomedImage.style.transform = `translate3d(${state.tx}px,${state.ty}px,0) scale(${state.scale})`;
      const needsReset = state.scale > 1.01 || Math.abs(state.tx) > 1 || Math.abs(state.ty) > 1;
      zoomToggle.textContent = needsReset ? '−' : '+';
      zoomToggle.setAttribute('aria-label', needsReset ? 'Reset zoom' : 'Zoom in');
    };

    const schedule = () => {
      if (!raf) {
        raf = requestAnimationFrame(() => {
          raf = null;
          clampPan();
          apply();
        });
      }
    };

    function measureBase() {
      const prev = zoomedImage.style.transform;
      zoomedImage.style.transform = 'translate3d(0,0,0) scale(1)';
      const r = zoomedImage.getBoundingClientRect();
      const s = stage.getBoundingClientRect();
      state.baseW = r.width;
      state.baseH = r.height;
      state.viewW = s.width;
      state.viewH = s.height;
      zoomedImage.style.transform = prev;
      if (zoomedImage.naturalWidth && state.baseW) {
        const limitW = zoomedImage.naturalWidth / state.baseW;
        const limitH = zoomedImage.naturalHeight / state.baseH;
        state.max = Math.max(1, Math.min(4, limitW, limitH));
      }
    }

    function clampPan() {
      const contentW = state.baseW * state.scale;
      const contentH = state.baseH * state.scale;
      const maxX = Math.max(0, (contentW - state.viewW) / 2);
      const maxY = Math.max(0, (contentH - state.viewH) / 2);
      state.tx = clamp(state.tx, -maxX, maxX);
      state.ty = clamp(state.ty, -maxY, maxY);
    }

    function zoomAt(cx, cy, nextScale) {
      nextScale = clamp(nextScale, state.min, state.max);
      const prev = state.scale;
      if (nextScale === prev) return;
      state.tx = cx - (cx - state.tx) * (nextScale / prev);
      state.ty = cy - (cy - state.ty) * (nextScale / prev);
      state.scale = nextScale;
      schedule();
    }

    function resetView() {
      state.scale = 1;
      state.tx = 0;
      state.ty = 0;
      schedule();
    }

    function showUI() {
      lightbox.classList.remove('ui-hidden');
      clearTimeout(idleTimer);
      idleTimer = setTimeout(() => lightbox.classList.add('ui-hidden'), 1600);
    }

    function setNavAvailability() {
      const hasMultiple = images.length > 1;
      if (prevBtn) prevBtn.disabled = !hasMultiple;
      if (nextBtn) nextBtn.disabled = !hasMultiple;
      if (sideNav) sideNav.hidden = !hasMultiple;
      if (dotsWrap) dotsWrap.hidden = !hasMultiple;
    }

    function buildDots() {
      if (!dotsWrap) return;
      dotsWrap.innerHTML = '';
      images.forEach((_, i) => {
        const dot = document.createElement('button');
        dot.type = 'button';
        dot.className = 'pdp-zoom__dot';
        dot.setAttribute('aria-label', `Go to image ${i + 1}`);
        dot.addEventListener('click', () => setSlide(i));
        dotsWrap.appendChild(dot);
      });
    }

    function setSlide(i) {
      if (!images.length) return;
      viewer.index = (i + images.length) % images.length;
      const item = images[viewer.index];
      zoomedImage.alt = item.alt || '';
      zoomedImage.removeAttribute('srcset');
      zoomedImage.removeAttribute('sizes');
      zoomedImage.src = item.src;
      if (counter) {
        counter.textContent = `${viewer.index + 1} / ${images.length}`;
      }
      if (dotsWrap) {
        [...dotsWrap.children].forEach((btn, idx) => {
          btn.setAttribute('aria-current', idx === viewer.index ? 'true' : 'false');
        });
      }
      if (images.length > 1) {
        [viewer.index - 1, viewer.index + 1].forEach((ii) => {
          const j = (ii + images.length) % images.length;
          const preload = new Image();
          preload.src = images[j].src;
        });
      }
      if (zoomedImage.complete && zoomedImage.naturalWidth > 0) {
        measureBase();
        resetView();
      } else {
        zoomedImage.onload = () => {
          measureBase();
          resetView();
          zoomedImage.onload = null;
        };
      }
      showUI();
    }

    function openAt(i, opener) {
      if (!images.length) return;
      const targetIndex = (i + images.length) % images.length;
      const wasOpen = viewer.isOpen;
      viewer.openerEl = opener || viewer.openerEl || null;
      if (!wasOpen) {
        viewer.isOpen = true;
        lightbox.classList.add('open');
        lightbox.classList.remove('ui-hidden', 'dragging');
        lightbox.setAttribute('aria-hidden', 'false');
        body.dataset.prevOverflow = body.style.overflow || '';
        body.style.overflow = 'hidden';
        trapFocus();
        zoomToggle.focus();
      }
      setSlide(targetIndex);
    }

    function close() {
      if (!viewer.isOpen) return;
      viewer.isOpen = false;
      lightbox.classList.remove('open', 'ui-hidden', 'dragging');
      lightbox.setAttribute('aria-hidden', 'true');
      body.style.overflow = body.dataset.prevOverflow || '';
      pts.clear();
      pinchStart = null;
      startDrag = null;
      clearTimeout(idleTimer);
      releaseFocus();
      viewer.openerEl?.focus?.();
    }

    closeBtn?.addEventListener('click', close);

    zoomToggle.addEventListener('click', () => {
      if (state.scale > 1.01 || Math.abs(state.tx) > 1 || Math.abs(state.ty) > 1) {
        resetView();
      } else {
        zoomAt(0, 0, Math.min(2, state.max));
      }
    });

    prevBtn?.addEventListener('click', () => setSlide(viewer.index - 1));
    nextBtn?.addEventListener('click', () => setSlide(viewer.index + 1));
    lightbox.addEventListener('mousemove', showUI);
    lightbox.addEventListener('click', (event) => {
      if (event.target === lightbox) close();
    });

    window.addEventListener('keydown', (event) => {
      if (!viewer.isOpen) return;
      if (event.key === 'Escape') {
        event.preventDefault();
        close();
      } else if (event.key === 'ArrowRight') {
        event.preventDefault();
        setSlide(viewer.index + 1);
      } else if (event.key === 'ArrowLeft') {
        event.preventDefault();
        setSlide(viewer.index - 1);
      } else if (event.key === '+' || (event.key === '=' && (event.ctrlKey || event.metaKey))) {
        event.preventDefault();
        zoomAt(0, 0, state.scale * 1.25);
      } else if (event.key === '-' || (event.key === '_' && (event.ctrlKey || event.metaKey))) {
        event.preventDefault();
        zoomAt(0, 0, state.scale / 1.25);
      }
    });

    stage.addEventListener('dblclick', (event) => {
      const rect = stage.getBoundingClientRect();
      const cx = event.clientX - (rect.left + rect.width / 2);
      const cy = event.clientY - (rect.top + rect.height / 2);
      const target = state.scale > 1 ? 1 : Math.min(2, state.max);
      zoomAt(cx, cy, target);
    });

    stage.addEventListener('pointerdown', (event) => {
      if (!viewer.isOpen) return;
      stage.setPointerCapture(event.pointerId);
      pts.set(event.pointerId, { x: event.clientX, y: event.clientY });
      if (pts.size === 1) {
        startDrag = { x: event.clientX, y: event.clientY, atScale: state.scale };
      }
      if (pts.size === 2) {
        const [a, b] = [...pts.values()];
        const dx = b.x - a.x;
        const dy = b.y - a.y;
        const dist = Math.hypot(dx, dy);
        const rect = stage.getBoundingClientRect();
        const cx = (a.x + b.x) / 2 - (rect.left + rect.width / 2);
        const cy = (a.y + b.y) / 2 - (rect.top + rect.height / 2);
        pinchStart = { dist, scale: state.scale, cx, cy };
      }
      lightbox.classList.add('dragging');
      showUI();
    });

    stage.addEventListener('pointermove', (event) => {
      if (!pts.has(event.pointerId)) return;
      const prev = pts.get(event.pointerId);
      const now = { x: event.clientX, y: event.clientY };
      pts.set(event.pointerId, now);

      if (pts.size === 1) {
        if (state.scale === 1 && startDrag) {
          const dx = now.x - startDrag.x;
          const dy = now.y - startDrag.y;
          if (Math.abs(dx) > 48 && Math.abs(dy) < 40) {
            setSlide(viewer.index + (dx < 0 ? 1 : -1));
            startDrag = { x: now.x, y: now.y, atScale: 1 };
            return;
          }
        }
        state.tx += now.x - prev.x;
        state.ty += now.y - prev.y;
        schedule();
      } else if (pts.size === 2 && pinchStart) {
        const [a, b] = [...pts.values()];
        const dx = b.x - a.x;
        const dy = b.y - a.y;
        const dist = Math.hypot(dx, dy);
        const next = clamp(pinchStart.scale * (dist / pinchStart.dist), state.min, state.max);
        zoomAt(pinchStart.cx, pinchStart.cy, next);
      }
    }, { passive: false });

    const end = (event) => {
      if (!pts.has(event.pointerId)) return;
      pts.delete(event.pointerId);
      if (pts.size < 2) pinchStart = null;
      if (pts.size === 0) {
        lightbox.classList.remove('dragging');
        startDrag = null;
      }
    };

    stage.addEventListener('pointerup', end);
    stage.addEventListener('pointercancel', end);
    stage.addEventListener('pointerleave', end);

    stage.addEventListener('wheel', (event) => {
      if (!viewer.isOpen) return;
      event.preventDefault();
      const factor = Math.exp(-event.deltaY * 0.0015);
      const rect = stage.getBoundingClientRect();
      const cx = event.clientX - (rect.left + rect.width / 2);
      const cy = event.clientY - (rect.top + rect.height / 2);
      zoomAt(cx, cy, state.scale * factor);
      showUI();
    }, { passive: false });

    new ResizeObserver(() => {
      if (viewer.isOpen) {
        measureBase();
        schedule();
      }
    }).observe(stage);

    let focusables = [];
    let firstEl = null;
    let lastEl = null;
    let prevActive = null;

    function trapFocus() {
      prevActive = document.activeElement;
      focusables = [...lightbox.querySelectorAll('button,[href],[tabindex]:not([tabindex="-1"])')];
      firstEl = focusables[0];
      lastEl = focusables[focusables.length - 1];
      lightbox.addEventListener('keydown', trapper);
    }

    function trapper(event) {
      if (event.key !== 'Tab') return;
      if (event.shiftKey && document.activeElement === firstEl) {
        event.preventDefault();
        lastEl?.focus?.();
      } else if (!event.shiftKey && document.activeElement === lastEl) {
        event.preventDefault();
        firstEl?.focus?.();
      }
    }

    function releaseFocus() {
      lightbox.removeEventListener('keydown', trapper);
      prevActive?.focus?.();
    }

    function setImages(nextImages) {
      const prevIndex = viewer.index || 0;
      images = Array.isArray(nextImages) ? nextImages.filter((img) => !!img?.src) : [];
      setNavAvailability();
      buildDots();
      if (!images.length) {
        viewer.index = 0;
        if (counter) counter.textContent = '';
        return viewer.isOpen ? close() : undefined;
      }
      viewer.index = Math.min(prevIndex, images.length - 1);
      if (viewer.isOpen) {
        setSlide(viewer.index);
      } else {
        zoomToggle.textContent = '+';
        zoomToggle.setAttribute('aria-label', 'Zoom in');
        if (counter) {
          counter.textContent = `${viewer.index + 1} / ${images.length}`;
        }
        if (dotsWrap) {
          [...dotsWrap.children].forEach((dot, idx) => {
            dot.setAttribute('aria-current', idx === viewer.index ? 'true' : 'false');
          });
        }
      }
    }

    return {
      setImages,
      openAt: (index, opener) => openAt(index ?? viewer.index, opener)
    };
  }
</script>
